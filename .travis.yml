sudo: required

language: node_js

services:
  - docker
  - mongodb

before_script:
  - cd microservices/forumApi
  - sleep 15
  - cp config/test.json.example config/text.json
  - mongo --eval 'use forumDb; db.createUser({user:"forumUser", pwd:"forumPass", roles:["readWrite"]});'

before_install:
  - cd microservices/forumApi
  - docker build -t bcgov/ocwa .

script:
  - cd microservices/forumApi
  - npm install
  - npm test
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin